<!DOCTYPE html>
<html class='w-full' lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Language Selector</title>
    <script src="https://unpkg.com/htmx.org@1.8.4"></script>
    <link rel="stylesheet" href="/style.css">
  </head>
  <body class='w-full'>
    <h1>Polyglot</h1>
    <p class="text-blue-500">This text will be blue.</p>

    <!-- buttons -->
    <button onclick="add_col()">
      Add Language (column)
    </button>
    <button onclick="add_row()">
      Add Phrase (row)
    </button>
    <!-- table-->
    <div class='overflow-x-auto w-full whitespace-nowrap table'>
      <!-- languages -->
      <div class='languages row w-full'>
          <select name="language" class='w-64 language border p-2'>
            <option value="english">English</option>
          </select>
          <select name="language" class='w-64 language border p-2'>
            <option value="spanish">Spanish</option>
          </select>
      </div>
      <!-- phrases -->
      <div class='phrases row w-full'>
        <input type='text' name='text' class='w-64 border p-2 phrase'>
        <div class='inline-block w-64 border border-black p-2'>text</div>
      </div>
    </div>
  </body>
  <script>
    languages = ["english", "spanish", "mandarin", "japanese", "russian", "hindi", "arabic", "portuguese"]
    options = languages.map(lang => `<option value='${lang}'>${lang}</option>`)

    function add_col() {
      let numColumns = document.querySelectorAll('.language').length;
      document.querySelectorAll('.row').forEach((row, i) => {
        if (i === 0) {
          // set the option for the select depending on the column number
          // i.e. match the language index to the column index
          row.insertAdjacentHTML('beforeend', `
            <select name='language' class='w-64 language border p-2'>
              ${options.map((opt, index) => 
                `<option value='${languages[index]}' ${index === numColumns ? 'selected' : ''}>${languages[index]}</option>`
              ).join('')}
            </select>
          `);
        } else {
          row.insertAdjacentHTML('beforeend', "<div class='w-64 border p-2 inline-block'>text</div>");
        }
      });
    }

    function add_row() {
      // add <div>1<input>#cols<div></div></div>
      
      let html = `
      <div class='phrase row w-full'>
        <input type='text' name='text' class='w-64 border p-2'></input>
      `
      document.querySelectorAll('.language').forEach((lang, i) => {
        if (i > 0) {
          html += `
          <div class='w-64 border p-2 inline-block'>${languages[i]}</div>
          `
        }
      });
      html += `</div>`
      document.querySelector('.table').insertAdjacentHTML('beforeend', html);
    }

  </script>
</html>
